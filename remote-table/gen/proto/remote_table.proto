syntax = "proto3";

package remote_table;

import "datafusion_common.proto";
import "datafusion.proto";

message RemoteTablePhysicalPlanNode {
  oneof RemoteTablePhysicalPlanType {
    RemoteTableScanExec scan = 1;
    RemoteTableInsertExec insert = 2;
  }
}

message RemoteTableScanExec {
  ConnectionOptions conn_options = 1;
  RemoteSource source = 2;
  datafusion_common.Schema table_schema = 3;
  RemoteSchema remote_schema = 4;
  Projection projection = 5;
  repeated string unparsed_filters = 6;
  optional uint32 limit = 7;
  bytes transform = 8;
}

message RemoteTableInsertExec {
  ConnectionOptions conn_options = 1;
  Identifiers table = 2;
  RemoteSchema remote_schema = 3;
  bytes literalizer = 4;
}

message ConnectionOptions {
  oneof connection_options {
    PostgresConnectionOptions postgres = 1;
    MysqlConnectionOptions mysql = 2;
    OracleConnectionOptions oracle = 3;
    SqliteConnectionOptions sqlite = 4;
    DmConnectionOptions dm = 5;
  }
}

message RemoteSource {
  oneof source {
    string query = 1;
    Identifiers table = 2;
  }
}

message Identifiers {
  repeated string idents = 1;
}

message PostgresConnectionOptions {
  string host = 1;
  uint32 port = 2;
  string username = 3;
  string password = 4;
  optional string database = 5;
  uint32 pool_max_size = 6;
  uint32 pool_min_idle = 7;
  Duration pool_idle_timeout = 8;
  Duration pool_ttl_check_interval = 9;
  uint32 stream_chunk_size = 10;
  int32 default_numeric_scale = 11;
}

message MysqlConnectionOptions {
  string host = 1;
  uint32 port = 2;
  string username = 3;
  string password = 4;
  optional string database = 5;
  uint32 pool_max_size = 6;
  uint32 pool_min_idle = 7;
  Duration pool_idle_timeout = 8;
  Duration pool_ttl_check_interval = 9;
  uint32 stream_chunk_size = 10;
}

message OracleConnectionOptions {
  string host = 1;
  uint32 port = 2;
  string username = 3;
  string password = 4;
  string service_name = 5;
  uint32 pool_max_size = 6;
  uint32 pool_min_idle = 7;
  Duration pool_idle_timeout = 8;
  Duration pool_ttl_check_interval = 9;
  uint32 stream_chunk_size = 10;
}

message SqliteConnectionOptions {
  string path = 1;
  uint32 stream_chunk_size = 2;
}

message DmConnectionOptions {
  string host = 1;
  uint32 port = 2;
  string username = 3;
  string password = 4;
  optional string schema = 5;
  uint32 stream_chunk_size = 6;
  string driver = 7;
}

message Duration {
  uint64 secs = 1;
  uint32 nanos = 2;
}

message Projection {
  repeated uint32 projection = 1;
}

message RemoteSchema {
  repeated RemoteField fields = 1;
}

message RemoteField {
  string name = 1;
  RemoteType remote_type = 2;
  bool nullable = 3;
  bool auto_increment = 4;
}

message RemoteType {
  oneof type {
    Empty postgres_int2 = 1;
    Empty postgres_int4 = 2;
    Empty postgres_int8 = 3;
    Empty postgres_float4 = 4;
    Empty postgres_float8 = 5;
    PostgresNumeric postgres_numeric = 6;
    Empty postgres_name = 7;
    Empty postgres_varchar = 8;
    Empty postgres_bpchar = 9;
    Empty postgres_text = 10;
    Empty postgres_bytea = 11;
    Empty postgres_date = 12;
    Empty postgres_time = 13;
    Empty postgres_timestamp = 14;
    Empty postgres_timestamp_tz = 15;
    Empty postgres_interval = 16;
    Empty postgres_bool = 17;
    Empty postgres_json = 18;
    Empty postgres_jsonb = 19;
    Empty postgres_int2_array = 20;
    Empty postgres_int4_array = 21;
    Empty postgres_int8_array = 22;
    Empty postgres_float4_array = 23;
    Empty postgres_float8_array = 24;
    Empty postgres_varchar_array = 25;
    Empty postgres_bpchar_array = 26;
    Empty postgres_text_array = 27;
    Empty postgres_bytea_array = 28;
    Empty postgres_bool_array = 29;
    Empty postgres_postgis_geometry = 30;
    Empty postgres_oid = 31;
    Empty postgres_xml = 32;
    Empty postgres_uuid = 33;
    Empty mysql_tiny_int = 101;
    Empty mysql_tiny_int_unsigned = 102;
    Empty mysql_small_int = 103;
    Empty mysql_small_int_unsigned = 104;
    Empty mysql_medium_int = 105;
    Empty mysql_medium_int_unsigned = 106;
    Empty mysql_integer = 107;
    Empty mysql_integer_unsigned = 108;
    Empty mysql_big_int = 109;
    Empty mysql_big_int_unsigned = 110;
    Empty mysql_float = 111;
    Empty mysql_double = 112;
    MysqlDecimal mysql_decimal = 113;
    Empty mysql_date = 114;
    Empty mysql_date_time = 115;
    Empty mysql_time = 116;
    Empty mysql_timestamp = 117;
    Empty mysql_year = 118;
    Empty mysql_char = 119;
    Empty mysql_varchar = 120;
    Empty mysql_binary = 121;
    Empty mysql_varbinary = 122;
    MysqlText mysql_text = 123;
    MysqlBlob mysql_blob = 124;
    Empty mysql_json = 125;
    Empty mysql_geometry = 126;
    OracleVarchar2 oracle_varchar2 = 201;
    OracleChar oracle_char = 202;
    OracleNumber oracle_number = 203;
    Empty oracle_date = 204;
    Empty oracle_timestamp = 205;
    Empty oracle_boolean = 206;
    Empty oracle_binary_float = 207;
    Empty oracle_binary_double = 208;
    Empty oracle_blob = 209;
    OracleFloat oracle_float = 210;
    OracleNChar oracle_nchar = 211;
    OracleNVarchar2 oracle_nvarchar2 = 212;
    OracleRaw oracle_raw = 213;
    Empty oracle_long_raw = 214;
    Empty oracle_long = 215;
    Empty oracle_clob = 216;
    Empty oracle_nclob = 217;
    Empty oracle_sde_geometry = 218;
    Empty sqlite_null = 301;
    Empty sqlite_integer = 302;
    Empty sqlite_real = 303;
    Empty sqlite_text = 304;
    Empty sqlite_blob = 305;
    Empty dm_tiny_int = 401;
    Empty dm_small_int = 402;
    Empty dm_integer = 403;
    Empty dm_big_int = 404;
    Empty dm_real = 405;
    Empty dm_double = 406;
    DmNumeric dm_numeric = 407;
    DmDecimal dm_decimal = 408;
    DmChar dm_char = 409;
    DmVarchar dm_varchar = 410;
    Empty dm_text = 411;
    DmBinary dm_binary = 412;
    DmVarbinary dm_varbinary = 413;
    Empty dm_image = 414;
    Empty dm_bit = 415;
    DmTimestamp dm_timestamp = 416;
    DmTime dm_time = 417;
    Empty dm_date = 418;
  }
}

// Place holder type for primitive types
message Empty {}

message PostgresNumeric {
  uint32 precision = 1;
  int32 scale = 2;
}


message MysqlDecimal {
  uint32 precision = 1;
  uint32 scale = 2;
}
message MysqlText {
  uint32 length = 1;
}
message MysqlBlob {
  uint32 length = 1;
}


message OracleVarchar2 {
  uint32 length = 1;
}
message OracleChar {
  uint32 length = 1;
}
message OracleNumber {
  uint32 precision = 1;
  int32 scale = 2;
}
message OracleFloat {
  uint32 precision = 1;
}
message OracleNChar {
  uint32 length = 1;
}
message OracleNVarchar2 {
  uint32 length = 1;
}
message OracleRaw {
  uint32 length = 1;
}


message DmNumeric {
  uint32 precision = 1;
  int32 scale = 2;
}
message DmDecimal {
  uint32 precision = 1;
  int32 scale = 2;
}
message DmChar {
  optional uint32 length = 1;
}
message DmVarchar {
  optional uint32 length = 1;
}
message DmBinary {
  uint32 length = 1;
}
message DmVarbinary {
  optional uint32 length = 1;
}
message DmTimestamp {
  uint32 precision = 1;
}
message DmTime {
  uint32 precision = 1;
}
